(function(e,p){typeof exports=="object"&&typeof module<"u"?module.exports=p(require("vue")):typeof define=="function"&&define.amd?define(["vue"],p):(e=typeof globalThis<"u"?globalThis:e||self,e.vueUeditorBlockPlus=p(e.Vue))})(this,function(e){"use strict";class p{constructor(){this.listeners={}}on(r,i){this.listeners[r]===void 0&&(this.listeners[r]={triggered:!1,requested:!1,cbs:[]}),this.listeners[r].triggered&&i(),this.listeners[r].cbs.push(i)}emit(r){this.listeners[r]&&(this.listeners[r].triggered=!0,this.listeners[r].cbs.forEach(i=>i()))}}function B(s,r){let i;const a=function(...t){i&&clearTimeout(i),i=setTimeout(()=>{s.apply(this,t)},r)};return a.cancel=function(){i!==void 0&&clearTimeout(i)},a}function O(s){return s.reduce((r,i)=>r.then(i),Promise.resolve())}function R(s){const r="abcdefghijklmnopqrstuvwxyz";let i="";for(let a=0;a<s;a++)i+=r.charAt(Math.floor(Math.random()*r.length));return i}const H="",T=["name"],L=["innerHTML"],S=[{__name:"index",props:{cname:{type:String,default:""},modelValue:{type:String,default:""},extraConfig:{type:Object,default:()=>({})},staticUrl:{type:String,default:"/UEditor/"},uploadUrl:{type:String,default:""},httpParams:{type:Object,default:()=>({})},name:{type:String,default:""},mode:{type:String,default:"observer",validator:(s,r)=>["observer","listener"].indexOf(s)!==-1},observerOptions:{type:Object,default:()=>({attributes:!0,attributeFilter:["src","style","type","name"],characterData:!0,childList:!0,subtree:!0})},observerDebounceTime:{type:Number,default:50,validator:(s,r)=>s>=20},forceInit:{type:Boolean,default:!1},destroy:{type:Boolean,default:!0},editorDependencies:{type:Array},editorDependenciesChecker:{type:Function},onlyShow:{type:Boolean,default:!1}},emits:["update:modelValue","ready","change"],setup(s,{expose:r,emit:i}){const a=i,t=s,c={UN_READY:"UN_READY",PENDING:"PENDING",READY:"READY"},w=e.ref(t.onlyShow);e.watch(()=>t.onlyShow,()=>{t.onlyShow?(m=c.UN_READY,o&&o.removeListener("contentChange",U),l&&l.disconnect(),o.destroy(),w.value=!0):(w.value=!1,e.nextTick(()=>{D()}))});let m=c.UN_READY,o,l,E;const _="editor_"+R(8),y=e.ref(null);let b={serverUrl:t.uploadUrl,UEDITOR_HOME_URL:t.staticUrl,autoHeightEnabled:!1,toolbars:[["fullscreen","bold","italic","underline","fontsize","insertimage","insertorderedlist","insertunorderedlist"],["source"]],initialFrameHeight:240,initialFrameWidth:"100%",enableAutoSave:!1,elementPathEnabled:!1,readonly:!1,wordCount:!0};for(let n in t.extraConfig)n!=="serverUrl"&&n!=="UEDITOR_HOME_URL"&&(b[n]=t.extraConfig[n]);const x=["ueditor.config.js","ueditor.all.min.js"],A=()=>window.UE&&window.UE.getEditor&&window.UEDITOR_CONFIG&&Object.keys(window.UEDITOR_CONFIG).length!==0,v=e.toRef(t,"modelValue");window.$loadEventBus||(window.$loadEventBus=new p);const I=n=>new Promise((h,g)=>{if(window.$loadEventBus.on(n,h),window.$loadEventBus.listeners[n].requested===!1){window.$loadEventBus.listeners[n].requested=!0;const d=document.createElement("script");d.src=n,d.onload=()=>{window.$loadEventBus.emit(n)},d.onerror=g,document.getElementsByTagName("head")[0].appendChild(d)}}),P=n=>new Promise((h,g)=>{if(window.$loadEventBus.on(n,h),window.$loadEventBus.listeners[n].requested===!1){window.$loadEventBus.listeners[n].requested=!0;const d=document.createElement("link");d.type="text/css",d.rel="stylesheet",d.href=n,d.onload=()=>{window.$loadEventBus.emit(n)},d.onerror=g,document.getElementsByTagName("head")[0].appendChild(d)}}),V=()=>new Promise((n,h)=>{if(t.editorDependencies&&t.editorDependenciesChecker&&t.editorDependenciesChecker()){n();return}if(!t.editorDependencies&&A()){n();return}const{jsLinks:g,cssLinks:d}=(t.editorDependencies||x).reduce((u,f)=>(/^((https?:)?\/\/)?[-a-zA-Z0-9]+(\.[-a-zA-Z0-9]+)+\//.test(f)||(f=b.UEDITOR_HOME_URL+f),f.slice(-3)===".js"?u.jsLinks.push(f):f.slice(-4)===".css"&&u.cssLinks.push(f),u),{jsLinks:[],cssLinks:[]});Promise.all([Promise.all(d.map(u=>P(u))),O(g.map(u=>()=>I(u)))]).then(()=>n()).catch(h)}),U=()=>{E=o.getContent(),a("update:modelValue",E)},j=()=>{o.addListener("contentChange",U)},N=()=>{o.document.getElementById("baidu_pastebin")||(E=o.getContent(),a("update:modelValue",E))},M=()=>{l=new MutationObserver(B(N,t.observerDebounceTime)),l.observe(o.body,t.observerOptions)},D=()=>{y.value&&(y.value.id=_),o=window.UE.getEditor(_,b),o.addListener("ready",()=>{m===c.READY?o.setContent(t.modelValue):(m=c.READY,a("ready",o),t.modelValue&&o.setContent(t.modelValue)),Object.keys(t.httpParams).length>0&&o.execCommand("serverparam",t.httpParams),t.mode==="observer"&&window.MutationObserver?M():j()})},k=()=>o;return e.watch(v,n=>{m===c.UN_READY?(m=c.PENDING,(t.forceInit||typeof window<"u")&&V().then(()=>{y.value?D():e.nextTick(()=>D())}).catch(()=>{throw new Error("[vue-ueditor-block-plus] UEditor 资源加载失败！请检查资源是否存在，UEDITOR_HOME_URL 是否配置正确！")})):m===c.READY&&(n===E||o.setContent(n||""),a("change",n))},{immediate:!0}),e.onDeactivated(()=>{o&&o.removeListener("contentChange",U),l&&l.disconnect()}),e.onBeforeUnmount(()=>{l&&l.disconnect&&l.disconnect(),t.destroy&&o&&o.destroy&&o.destroy()}),r({getExample:k}),(n,h)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["vue-ueditor-block-plus",e.unref(w)?"only-show":"",s.cname])},[e.withDirectives(e.createElementVNode("div",{ref_key:"container",ref:y,name:s.name},null,8,T),[[e.vShow,!e.unref(w)]]),e.unref(w)?(e.openBlock(),e.createElementBlock("div",{key:0,class:"view",style:e.normalizeStyle({"--img-sort":"url("+s.staticUrl+"themes/default/images/sortable.png)","--img-loading":"url("+s.staticUrl+"themes/default/images/loading.gif)","--img-loaderror":"url("+s.staticUrl+"themes/default/images/loaderror.png)","--img-anchor":"url("+s.staticUrl+"themes/default/images/anchor.gif)"}),innerHTML:e.unref(v)},null,12,L)):e.createCommentVNode("",!0)],2))}}],C={install(s){S.forEach(r=>{s.component(r.name,r)})}};return typeof window<"u"&&window.Vue&&window.Vue.use(C),C});
